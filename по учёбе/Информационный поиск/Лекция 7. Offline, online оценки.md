# Offline
У нас есть результат поиска по запросу -> получаем найденные документы -> это оценивают (crowd, acessors, эксперты).

В дополнение к позиционной метрике MAP, упомянутой на прошлой лекции также используется **MRR**
У нас есть несколько serp (страница с результатами поиска):
$$MRR =\frac{1}{N}\Sigma_{i=1}^N \frac{1}{pos(rel_i)}$$
, где N - это число запросов, то есть для каждого запроса мы смотрим на какой позиции находится первый релевантный документ.

Маркер Ашманова

**DSG** - discounted comulative gain.

$$CG = \Sigma_{k=1}^M (2^{rel(k)} - 1)$$
, где $rel(k) \in \{0,1,2,3,4\}$ оценка из 5 градаций

$DSG_{serp} = \Sigma_{k=1}^M \frac{2^{rel(k)} - 1}{log(k+1)}$
для одного серпа высчитывается.

$discount = \frac{1}{log(k+1)}$

если обобщить, то DSG эта метрика чувствительнее и хороша, когда мы только только разрабатываем поисковик для нас все запросы важны и эта метрика хорошо реагирует на любые положительные изменения системы.

**NDSG** - Способ нормализовать, сделать метрику чуть менее чувствительней (чтобы выбросы были не так критичны):
$$NDSG = \frac{DSG}{iDCG}$$
где IDCG - это идеальный DSG.

**RBP** - rank-based precision
$\theta$ - вероятность перехода с позиции 
$P_{stop} = 1 - \theta$
$P(look@k) = \theta^{k-1}$
$AvgExam = \Sigma_{k=1}^{\infty} k*P(look@k)*P(stop@k) = \frac{1}{1-\theta}$
$U@K = P(look@k)*Rel(k)$
$RBP=\Sigma_{k=1}^N \frac{U@K}{AvgExam}$


Как оценить $L_2$ (ранжирование) более менее понятно и просто. А как $L_0/L_1$?
- Terminate After $L_0 \to L_1$
- Limit $L_1 \to L_2$

Идеи:
1) Сэмлировать
2) Путь limit = Terminate After = 50k. То есть 50k в $L_2$ и отправим. ПОлучаем 50k отранжированные после $L_2$ (обозначим B) и у нас есть какой-то $L_1$, который формирует множество документов A. Давайте посмотрим какой пересечение у A и B. При хорошем $L_1$ при уменьшении лимита у $L_1$ пересечение остаётся большим. Это получается **полнота** $L_2$.
   А можно посчитать ранговую корреляцию $L_1/L_2/L_0$
   


# online
Это оценки реакций пользователя на нашу выдачу (serp):
- click - CTR, click position
- time - first/last click time
- query - количество переформулировок

**A/B тестирование**.
Возможная проблема - это протекание информации из тестовой группы в котрольную.

**TDI**

**Пирамида метрик**. (KPI "Key Point Indicators" - метрик)
Есть метрика всего поиска. Например: SpU - sessions per user, среднее время между сессиями.

Поиск состоит (компоненты и их метрики):
- Реклама
- Рекомендации
- Поиск. Здесь могут быть
	- предложения (кол-во действий, минимизировать)
	- сниппеты
	- выдачи
		- ранкинг
		- тех. метрики (время варки индекса; время доставки обновлений; latency; пропускная способность)
