# Что подсказывает ГПТ
## Вопрос.
У меня есть ряд одних чисел например схожести эмбеддингов статей и эмбеддинга компании для каждой недели в году, то есть у меня 52 числа. А так уже у меня есть ряд из значений цены акции этой компании в каждой неделе в году, то есть тоже 52 значения.  
Какие есть статистические методы для определения наличия взаимосвязи между одними значениям и другими, причём одни значения (косинусные расстояния) могут влиять на другие значения (цены на акции) с отложенным эффектом (время которого неизвестно)? А если взаимосвязь есть, то как оценить её величину?

### Ответ.
Для анализа взаимосвязи между двумя временными рядами, такими как схожесть эмбеддингов и цены акций, можно использовать несколько статистических методов. Прежде всего, важно отметить, что вы ищете не просто корреляцию, но и возможное наличие временных задержек в влиянии одного ряда на другой. Ниже приведены некоторые методы, которые могут быть полезны в вашем случае.
#### 1. Корреляционный анализ
– **Корреляция Пирсона**: Позволяет определить линейную взаимосвязь между двумя рядами. Однако этот метод не учитывает временные задержки.  
– **Кросс-корреляция**: Исследует корреляцию между рядами при различном смещении (лаге). Это полезно для выявления задержек во влиянии одних временных рядов на другие.
#### 2. Регрессионный анализ
– **Линейная регрессия**: Модель линейной зависимости одного переменной от другой. Может быть адекватной при отсутствии задержек в данных.  
– **Модель с временными задержками**: Использует переменные задержек (лаги) из одного ряда как предикторы для другого ряда. Например, можно создать модель с использованием лагов цен акций и значений схожести эмбеддингов.
#### 3. Модели временных рядов
– **ARIMA**: Модель авторегрессии интегрированного движущегося среднего (ARIMA) может быть использована для моделирования временных рядов, включая внешние переменные.  
– **VAR** (Vektor AutoRegression): Если два временных ряда взаимосвязаны и оба являются стационарными, можно использовать VAR для оценки влияния одной переменной на другую с учетом временной динамики.
#### 4. Кausalный анализ
– **Granger причинность**: Определяет, вызывает ли один временной ряд изменения в другом, с учетом задержек. Это особенно полезно, если вы хотите проверить, могут ли значения схожести эмбеддингов "обуславливать" значения цен акций.
#### 5. Оценка взаимосвязи
– Если взаимосвязь установлена, её величину можно оценить с помощью коэффициентов, подобных коэффициенту регрессии и значимости теста (например, t-теста для регрессий). Также можно использовать методы оценки эффекта, такие как:
1. **Коэффициент детерминации (R²)**: Отражает долю дисперсии зависимой переменной, объясняемую моделью.
2. **Чувствительность и специфичность анализа**: Если у вас есть бинарные переменные, можно использоватьROC-анализ.
3. **Визуализация**: Построение графиков совместного изменения рядов, скользящие средние и коррелационные графики могут помочь в оценке.



## Вопрос как метод проверки взаимосвязи использовать для многомерного ряда и ряда цен
Ответ: https://giga.chat/link/gcsGscAXHy

# Определение технологического прорыва
В общем плане работы в ноутбуке с кодом я дал определение момента времени, который является технологическим прорывом. Определение зависело от того как менялось движение прогресса за определённый период в прошлом и как менялась цена акций в прошлом и в будущем.

Напоминание какие гиперпараметры используются при отборе прорывов:
1) Количество месяцев $m_1$, на которых оцениваем движение прогресса:
   $progress(t - m_1 - lag, t - lag) - progress(t - 2 \cdot m_1 - lag, t - m_1 - lag) > threshold_1$
2) Количество месяцев $m_2$, на которых оцениваем движение цены:
   $price(t - m_2, t) - price(t - 2 \cdot m_2, t - m_2) > threshold_2$ 
   и  
   $price(t - m_2, t) > threshold_3$
## Эксперименты с перебором

### 1 вариант (устаревший)
Здесь будут подбираться и сравниваться гиперпараметры для дачи самого точного определения технологического прогресса:

В виде таблицы [тут](https://docs.google.com/spreadsheets/d/19Mkt3LuIJOpmXddvLMDS75XFBTY4LvGyQ2pnCN7yx00/edit?gid=0#gid=0).

Результаты подбора (значения после точки с запятой это значения без учёта тикеров без прорывов):
1) $m_1 = 7$, $m_2 = 3$, $trashold_1 = 0.05$,  $threshold_2 = 0.2$, $threshold_3 = 0.2$:
	1) $trashold_1 = 0.07$ (178 тикеров)
	2) $trashold_1 = 0.1$
	3) $trashold_1 = 0.13$
	4) $trashold_1 = 0.15$
2) $m_1 = 6$, $m_2 = 3$, $trashold_1 = 0.05$,  $threshold_2 = 0.2$, $threshold_3 = 0.2$:
	1) $trashold_1 = 0.07$
	   1) $trashold_1 = 0.1$ (115 тикеров)
	   2) $trashold_1 = 0.13$
	   3) $trashold_1 = 0.15$
3) $m_1 = 5$, $m_2 = 3$, $trashold_1 = 0.05$,  $threshold_2 = 0.2$, $threshold_3 = 0.2$: (220 тикеров)
	1) $trashold_1 = 0.07$
	   1) $trashold_1 = 0.1$
	   2) $trashold_1 = 0.13$
	   3) $trashold_1 = 0.15$
4) $m_1 = 4$, $m_2 = 3$, $trashold_1 = 0.05$,  $threshold_2 = 0.2$, $threshold_3 = 0.2$:
	2) $trashold_1 = 0.07$
	   1) $trashold_1 = 0.1$
	   2) $trashold_1 = 0.13$
	   3) $trashold_1 = 0.15$
5) $m_1 = 3$, $m_2 = 3$, $trashold_1 = 0.05$,  $threshold_2 = 0.2$, $threshold_3 = 0.2$:
     1) $trashold_1 = 0.07$
     2) $trashold_1 = 0.1$
     3) $trashold_1 = 0.13$
     4) $trashold_1 = 0.15$
6) $m_1 = 4$, $m_2 = 3$, $trashold_1 = 0.15$,  $threshold_2 = 0.1$, $threshold_3 = 0.2$:
     1) $trashold_2 = 0$. (35 тикеров)

### 2 вариант
Другой вариант описания компаний, который содержится в файлах с припиской "extended". 
С новым вариантом описания теперь используется средняя схожесть по топ 50 статей, а не минимум как было раньше.
Кроме того увеличено было и общее количество тикеров. В прошлом варианте было ~ 650 тикеров, а в extended варианте ~ 2100 тикеров.

Результаты подбора:
1) $m_1 = 5$, $m_2 = 3$, $trashold_1 = 0.03$,  $threshold_2 = 0.02$, $threshold_3 = 0.2$: (830 тикера)
	$m_1 = 5$, $m_2 = 3$, $trashold_1 = 0.03$,  $threshold_2 = 0.03$, $threshold_3 = 0.2$: (661 тикера)
	$m_1 = 5$, $m_2 = 3$, $trashold_1 = 0.04$,  $threshold_2 = 0.03$, $threshold_3 = 0.2$: (450 тикера)
2)  $m_1 = 6$, $m_2 = 3$, $trashold_1 = 0.03$,  $threshold_2 = 0.03$, $threshold_3 = 0.2$: (603 тикера)

**Был выбран**:
$m_1 = 5$, $m_2 = 3$,  $threshold_2 = 0.03$, $threshold_3 = 0.2$:
А $trashold_1 = 0.02$ или среднее значение близости прогресса к компании, если оно $> 0.02$.
Результаты работы модели, обученной на таких данных:
![[Pasted image 20250306152755.png]]

![[Pasted image 20250306152819.png]]

## Как точно оценивать качество определения. Создаём метрику
Эксперименты выше это, конечно, хорошо, но в них я определяю качество модели сравнивая непонятно что с непонятно чем. 

Разумным вариантом кажется создать **какой-то бенчмарк**, на котором определение должно показывать наилучшее качество, а уже потом сравнить параметры как в экспериментах выше. 
**Опишем каким будет бенчмарк**:
1) Бенчмарком будет какой-то набор дат (или временных промежутков), которые являются общепризнанными датами технологических прорывов.
2) В качестве бенчмарка прорывных статей берут победителей нобелевской премии. Можно попробовать это как-то адаптировать под наш случай.
3) 
### Список прорывов от deepseek (вариант 3)
Полный ответ с описанием причин прорывов [тут](https://chat.deepseek.com/a/chat/s/ebb12974-03b3-4dce-85b9-6c0ebeb79c21).
1. **Mobile Phones and 2G Networks**: [Early 1990s]: ["NOK", "MSI", "ERIC", "QCOM", "TXN"]
2. **Search Engines**: [September 1998]: ["YHOO", "BIDU", "MSFT", "IAC"]
3. **Cloud Computing**: [March 2006]: ["AMZN", "MSFT", "CRM", "GOOGL", "ORCL"]
4. **Big Data and Analytics**: [2006]: ["SPLK", "PLTR", "CLDR", "SNOW", "MDB"]
5. **Smartphones**: [January 2007]: ["AAPL", "QCOM", "SSNLF", "TSM", "SWKS"]
6. **Blockchain and Cryptocurrencies**: [January 2009]: ["COIN", "MSTR", "RIOT", "MARA", "SQ"]
7. **Artificial Intelligence and Machine Learning**: [2012]: ["NVDA", "GOOGL", "IBM", "AMD", "INTC"]
8. **Growing interest in cryptocurrencies**: [2017]
9. **5G Technology**: [April 2019]: ["QCOM", "VZ", "SWKS", "T", "TMUS"]
10. **Generative AI**: [November 2022]: ["MSFT", "NVDA", "AI", "GOOGL", "TSM"]
11. **Quantum Computing**: [October 2019]: ["IBM", "RGTI", "IONQ", "GOOGL", "HPE"
12. **Metaverse and Virtual Reality**: [October 2021]: ["META", "U", "RBLX", "SONY", "NVDA"]
13. **Electric Vehicles (EVs) and Autonomous Driving**: [July 2020]: ["TSLA", "RIVN", "NIO", "GM", "F"]
14. **Green Tech and Sustainable IT**: [2020]: ["ENPH", "FSLR", "NEE", "SPWR", "RUN"]
15. **Edge Computing**: [2020]: ["DELL", "HPE", "FSLY", "AMZN", "MSFT"]
16. **Cybersecurity**: [2020]: ["CRWD", "PANW", "ZS", "FTNT", "OKTA"]
17. **Space Technology**: [May 2020]: ["SPCE", "RKLB", "LMT", "BA", "NOC"]
18. **AI Regulation and Ethical AI**: [2023]: ["PLTR", "MSFT", "IBM", "GOOGL", "SNOW"]
19. **Advanced Robotics and Automation**: [2023]: ["PATH", "ABB", "TER", "IRBT", "ROK"]
20. **Decentralized Finance (DeFi) and Web3**: [2023]: ["COIN", "SQ", "SI", "MARA", "RIOT"]
### Эксперименты
Проверяем корреляцию между значениями динамики прогресса и динамики цены акции в каждой точке. 
Как именно вычисляется динамика:
1) Прогресса: $progress(t - m_1, t) - progress(t - 2 \cdot m_1, t - m_1)$
2) Цены акции: $price(t - m_2, t)$
3) Рост цены акции: $price(t - m_2, t) - price(t - 2 \cdot m_2, t - m_2) > threshold_2$ 
   и  
   $price(t - m_2, t) > threshold_3$
Значение порыва определено выше.
Значения $m_2$ = 3 месяцам.

**Пояснения к экспериментам**. 
Результаты эксперимента - это следующие значения значения: 
- средняя корреляция по всем тикерам
- доля тикеров с позитивно коррелирующими динамиками прогресса и цены акции
- средняя корреляция по тикерам из пункта выше
- доля прорыров из бенчмарков попавших в список вычисленных прорывов
- среднее отношение: $\dfrac{точки \space роста \space цены \space акций \space одновременно \space с \space ростом \space прогресса}{все \space точки \space роста \space цены \space акции}$.
Всего тикеров - 881.

#### Бенчмарк - варианты 1,2
Итак, **сами эксперименты с параметрами**:
1)  $m_1$ = 7 месяцев: $( -0.007; 18\%; 0.21; 1.4\%; 8\%)$
2) $m_1$ = 6 месяцев: $(-0.019; 16\%; 0.21; 5.6\%; 10\%)$
3) $m_1$ = 5 месяцев: $(-0.018; 16\% ; 0.21; 1.4\%; 13.3\%)$
4) $m_1$ = 4 месяцев: $(-0.025; 13\%; 0.2; 2.8\%; 11.5\%)$
5) $m_1 =$ 3 месяца: $(-0.03; 10\%; 0.19; 1.4\%; 10.7\%)$

**Чуть изменили определение динамики**:
$progress(t - m_1 - k, t - k) - progress(t - 2 \cdot m_1 - k, t - m_1 - k)$
1) $k = 1, m_1$ = 5 месяцев:  $( -0.017; 16\%; 0.21; 4.1\%; 12.7\%)$
2) $k = 2, m_1$ = 5 месяцев: $( -0.015; 16.6\%; 0.2; 5.6\%; 12.4\%)$
3) $k = 3, m_1$ = 5 месяцев: $( -0.0074; 16.7\%; 0.21; 5.6\%; 11.6\%)$
4) $k = 4, m_1$ = 5 месяцев: $( -0.0074; 16.7\%; 0.21; 5.6\%; 11.6\%)$
5) $k = 5, m_1$ = 5 месяцев: $( -0.002; 17.1\%; 0.21; 2.8\%; 11.3\%)$
6) $k = 1, m_1$ = 6 месяцев: $( -0.009; 16.9\%; 0.21; 4.2\%; 10.6\%)$
7) $k = 2, m_1$ = 6 месяцев: $( -0.0001; 16.7\%; 0.21; 4.8\%; 10.3\%)$

**Чуть изменили определение прогресса**:
$progress(t - m_1 - k, t - k) - progress(t - 2 \cdot m_1 - k, t - m_1 - k) > const_1$
Раньше $const_1 = max(0.02, средний прогресс по тикеру)$
Варьировать будем число, которое на месте 0.02.
1) $k = 1, m_1 =$ 5 месяцев: $( -0.017; 16\%; 0.21; 8.3\%; 25.5\%)$
2) $k = 2, m_1 =$ 5 месяцев: $( -0.015; 16.6\%; 0.21; 9.7\%; 25\%)$
3) $k = 3, m_1 =$ 5 месяцев: $( -0.007; 16.6\%; 0.21; 8.3\%; 25\%)$
4) $k = 4, m_1 =$ 5 месяцев: $( -0.0024; 17\%; 0.21; 7\%; 24.1\%)$

#### Бенчмарк - вариант 3
**Чуть изменили определение прогресса**:
$progress(t - m_1 - k, t - k) - progress(t - 2 \cdot m_1 - k, t - m_1 - k) > const_1$
$const_1 = max(0.01, средний \ прогресс \ по \ тикеру)$
В скобках у 4-го показателя доля найденных бенчмарков
по каждому индексу (полумесяцу), а не по прорыву (в прорыве несколько индексов).
1) $k = 0, m_1 =$ 3 месяцев: $( -0.033; 10\%; 0.19; 50(5.8)\%; 21.2\%)$
2) $k = 0, m_1 =$ 4 месяцев: $( -0.019; 10\%; 0.2; 50(6.3)\%; 22.3\%)$
3) $k = 2, m_1 =$ 4 месяцев: $( -0.009; 15.6\%; 0.2; 50(6)\%; 23.9\%)$
4) $k = 0, m_1 =$ 5 месяцев: $( -0.018; 16.3\%; 0.21; 50(6.7)\%; 23.6\%)$
5) $k = 1, m_1 =$ 5 месяцев: $( -0.017; 16\%; 0.21; 50(5.6)\%; 23.7\%)$
6) $k = 2, m_1 =$ 5 месяцев: $( -0.015; 16.6\%; 0.2; 50(4.7)\%; 23.6\%)$
7) $k = 3, m_1 =$ 5 месяцев: $( -0.007; 16.7\%; 0.21; 33\%; 23.3\%)$
8) $k = 0, m_1 =$ 6 месяцев: $( -0.007; 15.8\%; 0.21; 33\%; 21.4\%)$
9) $k = 2, m_1 =$ 6 месяцев: $( -0.0008; 16.7\%; 0.21; 33(4.7)\%; 20.8\%)$
